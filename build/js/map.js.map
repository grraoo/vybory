{"version":3,"file":"map.js","sources":["js/lib/fetch.js","js/lib/numberWithSpaces.js","js/map.js"],"sourcesContent":["export default fetch(`https://dashboard.sn-mg.ru/service/monitoring/dashboards?reportId=12253`).then(response => response.json());\n","/**\n * makes space-divided number\n * @param {number} x\n * @return {string}\n */\nfunction numberWithSpaces(x) {\n  if (x !== null && typeof x !== `undefined` && x !== ``) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, `&thinsp;`);\n  }\n  return `н/д`;\n}\n\nexport default numberWithSpaces;\n","import getData from \"./lib/fetch\"\nimport numberWithSpaces from \"./lib/numberWithSpaces\";\n\nconst bigNum = document.querySelector(`.big-num`);\n\nconst adoptTotal = (json => {\n\n  return json.datasheets.map(period => {\n      const timeStamp = new Date();\n      const time = period.title.split(`:`);\n      const [hours, minutes] = time;\n      timeStamp.setHours(hours);\n      timeStamp.setMinutes(minutes);\n      timeStamp.setSeconds(0);\n      const periodRegions = period.sheetData.regions.russia;\n      const regions = periodRegions;\n\n      return {\n        timeStamp: timeStamp,\n        regions: regions\n      };\n    });\n\n});\n\nconst paintMap = () => {\n  getData.then(adoptTotal).then(periods => {\n\n    const to = periods.find(period => (new Date() < period.timeStamp));\n    const current = {\n      to: to,\n      get total() {\n        const total = {\n          sum: 0,\n          regs: {}\n        };\n        let max = 0;\n        for (const reg in this.to.regions) {\n          if (this.to.regions.hasOwnProperty(reg)) {\n            const regValue = parseInt(this.to.regions[reg], 10) || 0;\n            if (regValue > max) {\n              total.max = reg;\n              max = regValue;\n            }\n            total.regs[reg] = regValue;\n            total.sum += regValue;\n          }\n        }\n        return total;\n      }\n    };\n    return {max: current.total.regs[current.total.max], regs: current.total.regs};\n  }).then(total => {\n    for (const reg in total.regs) {\n      if (total.regs.hasOwnProperty(reg)) {\n        const value = (1 - 3 * (total.regs[reg] / total.max)).toFixed(2);\n        const region = document.getElementById(reg);\n        if(region && parseInt(value) < 1) {\n          region.style.fill = `rgba(0, 109, 196, ${1 - value})`;\n        }\n      }\n    }\n    bigNum.innerHTML = numberWithSpaces(total.regs.moscow);\n  }).catch(error => {\n    console.error(error)\n  });\n}\npaintMap();\nsetTimeout(() => {\n  paintMap();\n}, 60000);\n"],"names":[],"mappings":"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"}