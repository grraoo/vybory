{"version":3,"file":"map.js","sources":["js/lib/fetch.js","js/lib/numberWithSpaces.js","js/map.js"],"sourcesContent":["export default fetch(`https://dashboard.sn-mg.ru/service/monitoring/dashboards?reportId=12253`).then(response => response.json());\r\n","/**\r\n * makes space-divided number\r\n * @param {number} x\r\n * @return {string}\r\n */\r\nfunction numberWithSpaces(x) {\r\n  if (x !== null && typeof x !== `undefined` && x !== ``) {\r\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, `&thinsp;`);\r\n  }\r\n  return `н/д`;\r\n}\r\n\r\nexport default numberWithSpaces;\r\n","import getData from \"./lib/fetch\"\nimport numberWithSpaces from \"./lib/numberWithSpaces\";\n\nconst bigNum = document.querySelector(`.slider`);\nconst map = document.querySelector(`.main-map`);\nlet interval = 0;\nconst adoptTotal = (json => {\n  return json.datasheets.map(period => {\n      const timeStamp = new Date();\n      const time = period.title.split(`:`);\n      const [hours, minutes] = time;\n      timeStamp.setHours(hours);\n      timeStamp.setMinutes(minutes);\n      timeStamp.setSeconds(0);\n      const periodRegions = period.sheetData.regions.russia;\n      const regions = periodRegions;\n\n      return {\n        timeStamp: timeStamp,\n        regions: regions\n      };\n    });\n});\n\nconst paintMap = () => {\n  getData.then(adoptTotal).then(periods => {\n\n    const to = periods.find(period => (new Date() < period.timeStamp)) || periods[periods.length - 1];\n    const current = {\n      to: to,\n      get total() {\n        const total = {\n          sum: 0,\n          regs: {}\n        };\n        let max = 0;\n        for (const reg in this.to.regions) {\n          if (this.to.regions.hasOwnProperty(reg)) {\n\n            const regValue = parseInt(this.to.regions[reg], 10) || 0;\n            if (regValue > max) {\n              total.max = reg;\n              max = regValue;\n            }\n            total.regs[reg] = regValue;\n            total.sum += regValue;\n          }\n        }\n        return total;\n      }\n    };\n    return {max: current.total.regs[current.total.max], regs: current.total.regs};\n  }).then(total => {\n    const currentRegs = [];\n    for (const reg in total.regs) {\n      if (total.regs.hasOwnProperty(reg)) {\n        const value = (1 - 3 * (total.regs[reg] / total.max)).toFixed(2);\n        const region = document.getElementById(reg);\n        if(region && parseInt(value) < 1) {\n          currentRegs.push(reg);\n          region.style.fill = `rgba(0, 109, 196, ${1 - value})`;\n          bigNum.querySelector(`.slide--${reg} .big-num`).innerHTML = numberWithSpaces(total.regs[reg]);\n        }\n      }\n    }\n    return currentRegs;\n  }).then(regs => {\n    const slides = regs.map(reg => bigNum.querySelector(`.slide--${reg}`));\n    if (interval) {\n      console.log(interval);\n      clearInterval(interval);\n    }\n    interval = setInterval(() => {\n      const active = slides.find(slide => slide.classList.contains(`slide--active`));\n      if(active){\n        active.classList.remove(`slide--active`)\n      }\n      const index = (slides.indexOf(active) + 1) % slides.length;\n      slides[index].classList.add(`slide--active`);\n      if(regs[index] === `moscow`) {\n        map.style = `transform: translate(151%, 24%) scale(4.5);`\n      } else if (regs[index] === `spb`){\n        map.style = `transform: translate(95%, 48%) scale(3);`\n      } else if (regs[index] === `krasnoyarsk`){\n        map.style = `transform: translate(-7%, -18%) scale(1.3)`\n      } else if (regs[index] === `nnovgorod`){\n        map.style = `transform: translate(96%, -8%) scale(3.2);`\n\n      } else {\n        map.style = ``\n      }\n    }, 5000);\n    console.log(interval);\n  })\n  .catch(error => {\n    console.error(error)\n  });\n}\npaintMap();\nsetTimeout(() => {\n  paintMap();\n}, 60000);\n"],"names":[],"mappings":"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"}