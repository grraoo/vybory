{"version":3,"file":"total.js","sources":["js/lib/fetch.js","js/lib/numberWithSpaces.js","js/total.js"],"sourcesContent":["export default fetch(`https://dashboard.sn-mg.ru/service/monitoring/dashboards?reportId=12253`).then(response => response.json());\n","/**\n * makes space-divided number\n * @param {number} x\n * @return {string}\n */\nfunction numberWithSpaces(x) {\n  if (x !== null && typeof x !== `undefined` && x !== ``) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, `&thinsp;`);\n  }\n  return `н/д`;\n}\n\nexport default numberWithSpaces;\n","import getData from \"./lib/fetch\"\nimport numberWithSpaces from \"./lib/numberWithSpaces\";\n\nconst totalNumber = document.getElementById(`total-number`);\n\nconst adoptTotal = (json => {\n  const periods = json.datasheets.map(period => {\n    const timeStamp = new Date();\n    const time = period.title.split(`:`);\n    const [hours, minutes] = time;\n    timeStamp.setHours(hours);\n    timeStamp.setMinutes(minutes);\n    timeStamp.setSeconds(0);\n    const periodTotal = period.sheetData.snetwork.total;\n    let sum = 0;\n    for (const sn in periodTotal) {\n      if (periodTotal.hasOwnProperty(sn)) {\n        sum += parseInt(periodTotal[sn], 10);\n      }\n    }\n    return {\n      timeStamp: timeStamp,\n      _sum: parseInt(sum, 10),\n      total() {\n        return this._sum;\n      }\n    };\n  });\n\n  return periods;\n\n});\nlet interval;\nconst reCountTotal = () => {\n  getData.then(adoptTotal).then(periods => {\n    const to = periods.find(period => (new Date() < period.timeStamp));\n    const from = [...periods].reverse().find(period => (new Date() >= period.timeStamp));\n    const current = {\n      from: from,\n      to: to,\n      get time() {\n        return new Date()\n      },\n      get length() {\n        return this.to.timeStamp - this.from.timeStamp\n      },\n      get percent() {\n        return (this.time - this.from.timeStamp) / this.length\n      },\n      get total() {\n        return this.from.total() + (this.to.total() - this.from.total()) * this.percent;\n      },\n\n      get rest() {\n        return this.to.total() - this.total\n      },\n    };\n    clearInterval(interval);\n    interval = setInterval(() => {\n      totalNumber.innerHTML = numberWithSpaces(Math.round(current.total));\n    }, 1000)\n  }).catch(error => {\n    console.error(error)\n  });\n}\nreCountTotal();\nsetInterval(reCountTotal, 60000);\n"],"names":[],"mappings":"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"}