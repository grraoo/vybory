{"version":3,"file":"last.js","sources":["js/lib/fetch.js","js/lib/numberWithSpaces.js","js/last.js"],"sourcesContent":["export default fetch(`https://dashboard.sn-mg.ru/service/monitoring/dashboards?reportId=12253`).then(response => response.json());\r\n","/**\r\n * makes space-divided number\r\n * @param {number} x\r\n * @return {string}\r\n */\r\nfunction numberWithSpaces(x) {\r\n  if (x !== null && typeof x !== `undefined` && x !== ``) {\r\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, `&thinsp;`);\r\n  }\r\n  return `н/д`;\r\n}\r\n\r\nexport default numberWithSpaces;\r\n","import getData from \"./lib/fetch\"\nimport numberWithSpaces from \"./lib/numberWithSpaces\";\n\nconst columns = document.querySelector(`.columns`);\nconst bigNum = document.querySelector(`.big-num`);\nconst growNum = (node, num) => {\n  console.log(node, num)\n  let temp = 0;\n  let grow = setInterval(() => {\n    if(temp++ <= num) {\n      node.innerHTML = numberWithSpaces(temp);\n    } else {\n      clearInterval(grow);\n      let temp = 0;\n    }\n  }, 5);\n}\nconst adoptTotal = (json => {\n  const periods = json.properties[`10min_dynamics`];\n  const data = [];\n  for (const period in periods) {\n    if (periods.hasOwnProperty(period)) {\n      const timeStamp = new Date();\n      const time = period.split(`:`);\n      const [hours, minutes] = time;\n      timeStamp.setHours(hours);\n      timeStamp.setMinutes(minutes);\n      timeStamp.setSeconds(0);\n      const number = parseInt(periods[period], 10);\n      data.push({\n        timeStamp: timeStamp,\n        number: number\n      })\n    }\n  }\n  return data;\n\n});\n\nconst buildLast = () => {\n  getData.then(adoptTotal).then(periods => {\n    const to = periods.find(period => (new Date() < period.timeStamp)) || periods[periods.length - 1];\n    const index = periods.indexOf(to);\n    const periods8 = [];\n    for (let i = index - 8; i < index; i++) {\n      if (periods[i]) {\n        periods8.push(periods[i].number);\n      }\n    }\n    return periods8;\n  }).then(current => {\n    const max = Math.max(...current) * 5;\n    const average = current[current.length - 1];\n    const diff = current[current.length - 1] - current[current.length - 2];\n    columns.innerHTML = ``;\n    current.forEach(number => {\n      const column = document.createElement(`div`);\n      const innerColumn = document.createElement(`div`);\n      column.classList.add(`column`);\n      innerColumn.style = `height: calc(5 * ${(number) * 23 / max}vh)`;\n      column.appendChild(innerColumn);\n      columns.appendChild(column);\n    });\n    if (diff >= 0) {\n      bigNum.classList.remove(`big-num--down`);\n      bigNum.classList.add(`big-num--up`);\n    } else {\n      bigNum.classList.remove(`big-num--up`);\n      bigNum.classList.add(`big-num--down`);\n    }\n    bigNum.dataset.average = average;\n  }).catch(error => {\n    console.error(error);\n  });\n}\nbuildLast();\nsetTimeout(() => {\n  buildLast();\n}, 60000);\n"],"names":[],"mappings":"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"}