{"version":3,"file":"socnet.js","sources":["js/lib/fetch.js","js/lib/numberWithSpaces.js","js/socnet.js"],"sourcesContent":["export default fetch(`https://dashboard.sn-mg.ru/service/monitoring/dashboards?reportId=12253`).then(response => response.json());\r\n","/**\n * makes space-divided number\n * @param {number} x\n * @return {string}\n */\nfunction numberWithSpaces(x) {\n  if (x !== null && typeof x !== `undefined` && x !== `` && x.toString().length > 4) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, `&thinsp;`);\n  }\n  return x;\n}\n\nexport default numberWithSpaces;\n","import getData from \"./lib/fetch\"\nimport numberWithSpaces from \"./lib/numberWithSpaces\";\n\nconst socnets = document.querySelector(`.socnets`);\n\nconst adoptTotal = (json => {\n  const periods = json.datasheets.map(period => {\n    const timeStamp = new Date();\n    const time = period.title.split(`:`);\n    const [hours, minutes] = time;\n    timeStamp.setHours(hours);\n    timeStamp.setMinutes(minutes);\n    timeStamp.setSeconds(0);\n    const periodTotal = period.sheetData.snetwork.total;\n    let sum = 0;\n    const snets = {};\n    for (const sn in periodTotal) {\n      if (periodTotal.hasOwnProperty(sn)) {\n        snets[sn] = parseInt(periodTotal[sn], 10);\n        sum += snets[sn];\n      }\n    }\n    return {\n      timeStamp: timeStamp,\n      _sum: parseInt(sum, 10),\n      total() {\n        return this._sum;\n      },\n      snets: snets\n    };\n  });\n\n  return periods;\n\n});\n\nconst countStats = () => {\n  getData.then(adoptTotal).then(periods => {\n    const prev = [...periods].reverse().find(period => (new Date() >= period.timeStamp));\n    const to = periods.find(period => (new Date() < period.timeStamp)) || prev;\n    const current = {\n      from: prev,\n      to: to,\n      get diff() {\n        return this.to.total() - this.from.total();\n      },\n      get total() {\n        const total = {\n          sum: 0,\n          snets: {}\n        };\n        let max = 0;\n        for (const sn in this.to.snets) {\n          if (this.to.snets.hasOwnProperty(sn)) {\n            const percent = Math.round(100 * (this.to.snets[sn] - this.from.snets[sn]) / this.diff)\n            if (percent > max) {\n              total.max = sn;\n              max = percent;\n            }\n            total.snets[sn] = `${percent}%`;\n            total.sum += percent;\n          }\n        }\n        const percentSum = 0;\n        const percentArr = [];\n        if (total.sum !== 100) {\n          total.snets[total.max] = `${parseInt(total.snets[total.max], 10) - (total.sum - 100)}%`;\n        }\n        return total;\n      }\n    };\n    return current.total.snets;\n  }).then(total => {\n    for (const sn in total) {\n      if (total.hasOwnProperty(sn)) {\n        socnets.querySelector(`#${sn}`).innerText = total[sn];\n      }\n    }\n    socnets.classList.add(`animated`);\n    // socnets.innerHTML = socnets.innerHTML;\n  }).catch(error => {\n    console.error(error)\n  });\n}\ncountStats();\nsetInterval(countStats, 10000)\n"],"names":[],"mappings":"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"}